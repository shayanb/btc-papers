% !TEX root = ../main.tex

% = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

\section{Introduction}
In all of the excitement surrounding Bitcoin~\cite{Nak08}, it is easy to forget that the decentralized currency assumes a solution to the longstanding problem of usable public key cryptography for user authentication. Studies of the usability of key management~\cite{GM05,GMSN+05,SBKH06,GFF06} have shown that there are numerous usability issues that prevent public key cryptography from being effectively leveraged by end users. Managing, controlling, and using cryptographic keys are complex tasks, and no clear solution has been proposed.  

Despite the known complexity in creating and managing cryptographic keys, the Bitcoin network and software clients use such keys extensively for many operations. For example, digital signatures, which require the Bitcoin software to read private keys into memory, are used to assert ownership over a specific set of Bitcoins. Thus, managing the same coins on multiple devices (\eg a desktop and a phone) requires the corresponding private keys to be copied to and made accessible on these devices. 

%\subsection{Consumer Protection} 

The consequences of losing exclusive control over an account containing monetary value connects the threat of losing a Bitcoin private key to that of losing an online banking password. However, consumers in many countries are legally protected from any liability of banking credential loss. Furthermore, most bank transactions are traceable and reversible, making it difficult to extract value from stolen banking credentials (most techniques involve a mule~\cite{FH12}). Bitcoin transactions are also traceable, however they are not reversible. Stolen Bitcoins can thus not be centrally or automatically recovered. Bitcoin users typically have no legal protection against loss or theft, and while stolen Bitcoins could be traced as they change ownership,\footnote{Public keys associated with specific Bitcoins are publicly available in the Bitcoin blockchain, but the identities of users who control those keys are not.} several mechanisms exist for laundering Bitcoins and similar digital currencies~\cite{MGGR13,BNMC+14}.

In an effort to address some of the complexities of key management, developers of Bitcoin software have created a variety of innovative technologies. These technologies range  from password-derived keys to air-gapped computers to physical printouts of private keys in the form of 2D barcodes. However, since none of these proposals have been evaluated in the Bitcoin context, it remains unclear which techniques have usability advantages.

For Bitcoin to flourish, adoption will need to grow beyond developers and tech-savvy enthusiasts, and novice users will need to be able to reap the benefits of participating in the new technology. This solidifies the need for a usable, comprehensible approach to Bitcoin. If users cannot understand the details of key management in Bitcoin, it may result in the users' loss of funds and/or a poor reputation for Bitcoin, both of which could dissuade further user adoption. 

In this paper, we aim to investigate the usability challenges surrounding key management in Bitcoin. To do this, we survey and categorize the most prominent Bitcoin key management proposals. Next we conduct an expert usability inspection technique known as a cognitive walkthrough~\cite{WRLP94} on popular examples of each proposal. Our goal is to identify overarching usability issues as well as advantages of specific proposals, allowing us to propose design recommendations for future Bitcoin clients.

%Despite decades of research on this exact issue in parallel technologies, such as digitally signed email, Bitcoin software technologies for creating, storing, and managing keys stall on many of the same basic issues. 

%At the same time, the developer-heavy Bitcoin community has been very prolific in producing deployed technologies with a wide variety of approaches to solving the challenges of a key-based system. We therefore argue that studying this suite of technology offers the clearest picture yet of the challenges in usable key management for digital signatures. 

Specifically, the contributions of the paper are as follows:

\begin{compactlist}
\item We perform a broad survey of six Bitcoin key management techniques which cover the vast majority of deployed Bitcoin software. 

\item Using the results from our survey, we propose an evaluation and comparison framework for Bitcoin key management techniques. The framework is based on 10 security, usability and deployability criteria, and enables direct comparison of current and future key management proposals. Using our framework we find that certain properties, such as trust in a central party enable additional beneficial properties. We also find that the disadvantages of certain properties, such as malware protection, outweigh the relative benefits.

\item We perform a cognitive walkthrough of six distinct Bitcoin clients and tools to identify usability issues while performing basic Bitcoin tasks (\eg viewing account balance, sending funds, \etc). We find that the metaphors and abstractions used in the surveyed clients are subject to misinterpretations, and that the clients do not do enough to support their users.

\end{compactlist}

%Our contribution is two-fold. First, the breadth of techniques that have been deployed for Bitcoin key management---from air gapped computers to paper printouts of QR codes to password-derived keys---demands an equally broad benchmark for objectively rating and comparing solutions. To address this, we develop an evaluation framework for Bitcoin key management techniques, based on the framework of Bonneau \etal~\cite{BHOS12}, to enable direct comparison between the various proposed solutions on usability, deployability and security criteria.

%Second, we perform cognitive walkthroughs focusing on the usability of six distinct Bitcoin key management approaches. Evaluating any set of competing approaches is difficult to do in a thorough, objective way without employing a formal usability evaluation. While user studies are considered the gold standard for this purpose, user studies have been traditionally employed to rigorously compare a small number of systems according to a narrow set of measurable properties. By contrast, we are interested in revealing broader mental model issues across a wider spectrum of tools. Expert evaluation enables the breadth of evaluation we require, and we use the cognitive walkthrough methodology to maintain rigour and objectivity in our evaluation. 

% \paragraph{Scope}
% The focus of this work is the configuration and management of the cryptographic keys required to hold and spend Bitcoin. This paper is not a study of the usability of Bitcoin itself---\eg sending and receiving transactions with various software tools. There is no doubt that such a study would be a valuable contribution to the literature, however we believe key management is the harder, fundamental problem that ultimately cannot be addressed with better user interfaces or dialogues. Without a secure, usable path-forward, we expect Bitcoin adoption among non-experts to stall.

%Bitcoin can be split into 3 parts: buying bitcoins (involving exchanges, OTC, etc), holding bitcoins (involving wallets, keys, etc), and spending bitcoins (creating transactions, waiting for verifications, etc). this paper focuses on the middle point. 

% = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

\section{Background}
\subsection{Bitcoin}
Bitcoin is a cryptographic currency deployed in 2009~\cite{Nak08} which has reached a level of adoption unrealized by decades of previously proposed digital currencies (from 1982~\cite{Cha82} onward). Unlike many previous proposals, Bitcoin does not distribute digital monetary units to users. Instead, a public ledger maintains a list of every transaction\footnote{Technically, a transaction specifies a short script that encodes how the balance can be claimed as the input to some future transaction.} made by all Bitcoin users since the creation of the currency. A \textit{transaction} in its simplest form describes the movement of some balance of the Bitcoin currency (XBT or BTC) from one or more accounts (called input addresses) into one or more accounts (called output addresses). Bitcoin addresses are indexed by the fingerprint of a public key from a digital signature scheme.\footnote{Elliptic Curve Digital Signature Algorithm (ECDSA)~\cite{ecdsa}.} They are not centrally allocated or registered in any way---the addresses become active when the first transaction moving money into them is added to the ledger. 

In Bitcoin, every transaction must be digitally signed using the private signing key associated with each input address in the transaction. In order to spend Bitcoin, users require access to the signing key of the account holding their Bitcoin. Thus users do not maintain any kind of units of currency; they maintain a set of keys that provide them signing authority over certain accounts recorded in the ledger. 

The ledger (known as the \emph{blockchain}) is maintained and updated by a decentralized network using a novel method to reach consensus that involves incentivizing nodes in the network with the ability to generate (known as mining) new Bitcoin and collect transaction fees. The details of the Bitcoin consensus model are not relevant to this paper, but we note that clients in the network participate in the consensus model by downloading and cryptographically verifying the integrity of the blockchain. As of writing, the Bitcoin blockchain is roughly 25 GB in size.\footnote{Due to the large size of the blockchain, full download is infeasible for thin clients running on mobile devices, as well as some desktop clients. These clients connect to a semi-trusted node and only request transactions relevant to keys in their wallet. This technique, known as Simplified Payment Verification (SPV), eliminates the need to download and verify the whole blockchain but also creates privacy risks~\cite{SPVbugs}.}

One subtlety of Bitcoin's transaction architecture is that in order to spend Bitcoins, the entire value of unspent outputs (\ie from previous transactions) must be spent. To accommodate this, Bitcoin clients automatically spend the full amount of unspent outputs and create multiple components in the transaction: one component will send part of the unspent coins to the intended recipient, and the other component will send the remaining inputs back to the sender as \emph{change}. It is technically possible (and some clients behave this way) to send change back to the sending address. However, to enhance anonymity, the reference client generates fresh addresses (and corresponding private keys) to receive the remaining transaction amount. 

As more transactions are made, Bitcoin clients must keep track of multiple private keys for use in future transactions. Many clients prominently display a Bitcoin balance on the main screen, which represents the sum of all unspent outputs for which private keys are available. 
% One subtlety of Bitcoin transactions is that each XBT amount in the set of inputs must reference past transactions where the address received adequate XBT to cover the input amount. The complexity here is that a transaction must completely spend the amount received in these past transactions even if it is larger than the amount in the current transaction. To enable this, transactions will output the surplus XBT back to the sender as `change.' Change can be sent back to the same input address, or to enhance privacy, it can be sent to a brand new address created by the sender's client (called `change addresses'). 

\subsection{Usability of Key Management}

Passwords remain the most common form of user authentication~\cite{Herley.2012}. By contrast, private key-based authentication is rarely used by non-experts, and is typically never used as the default configuration in applications which support this authentication method. Transport Layer Security (TLS) client-side certificates have failed to reached wide-spread deployment, and recent efforts to reintegrate them in a different form (\eg origin-bound certificates~\cite{DCBW12}) still rely on passwords as the primary authentication mechanism. Similarly, while secure shell (SSH) can be used with certificates, passwords are commonly used as the default authentication mechanism.

Password managers, when configured to generate or store system-chosen random passwords, share at least one property of cryptographic keys: such passwords become something you \emph{have} instead of \emph{know}. However, if access to such a password is lost, online services generally offer account recovery mechanisms (\eg based on email). No such recovery mechanism exists for self-managed cryptographic keys.

The use of public key systems by non-experts that is closest to Bitcoin is arguably encrypted/authenticated email, in particular Pretty Good Privacy (PGP) and its open-source alternatives (\ie GPG and OpenPGP). Beginning with \emph{Why Johnny Can't Encrypt}~\cite{WT99}, the usability of public key technology has been well-studied from a usability perspective~\cite{GM05,GMSN+05,SBKH06,GFF06}. The findings of this literature are diverse but relevant observations include the following: (1) the metaphor and terminology behind public and private keys is confusing; (2) it is difficult to correctly obtain other users' public keys; (3) key migration between devices is difficult. This literature tends to focus primarily on encryption and not signatures, but we find some overlap to the work presented here. 

%\footnote{``Why King George III can encrypt,'' \textit{Freedom to Tinker} (blog), 6/6/2014.}

% = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

\section{Bitcoin Key Management Approaches} 
\label{sec:approaches}

Before turning to a detailed usability evaluation, we evaluate from a systems perspective each category of tool for managing Bitcoin private keys. We highlight security and deployability issues, and note relevant details of the Bitcoin protocol that create complexities and potential discrepancies with users' mental models.

\subsection{Keys in Local Storage}
\label{sec:localstorage}
One way in which Bitcoin software manages several private keys is by storing these keys on the device's local storage, typically in a file or database in a pre-configured file system path. When a new transaction is created, the Bitcoin client can read the keys and immediately (possibly without any further user input) broadcast the transaction over the network. The reference Bitcoin client (Bitcoin Core) uses this approach, storing private keys in a file (referred to as a \emph{wallet}) inside the user's home or application directory. 

%advantages
Storing keys in a locally accessible file has several advantages. First, there is no additional cognitive load on users, since only the software must access the file. Second, a practically unlimited number of keys can be stored on disk due to the small size of keys. Third, the Bitcoin software can automatically generate keys and create transactions without additional input or actions from the user. 

%threats-malware
Storing keys locally also creates several threats, which the user must consider. For example, the file storing private keys can be read by any application with access to the user's application folder. Malware authors may be particularly interested in exploiting this key management approach, since access to the local file results in the adversary gaining immediate access to the victim's funds. One of the first examples of private key-stealing malware was discovered by Symantec in 2011~\cite{coinbit}, with many other similar malware examples following suit.

%sharing or losing

Unintentional sharing of the locally stored file is also a concern for users. Users must be cautious to not inadvertently share their Bitcoin application folder (\eg through peer-to-peer file sharing networks, off-site backups or on a shared network drive). Physical theft, especially in the case of portable computers or smartphones must also be considered. Similar to the storage of other sensitive files, threats to digital preservation~\cite{BKM05} should be taken into account. Examples include general equipment failure due to natural disasters and electrical failures; acts of war; mistaken erasure (\eg formatting the wrong drive or deleting the wrong folder); bit rot (\ie undetected storage failure); and possibly others. If storing private keys for a long period of time (\eg a trust fund or long-term savings), users must also preserve a specification of the file format to ensure the keys can continue to be read.

%key churn
The reference Bitcoin client pre-generates keys in a batch of 100 (these keys are known as the keypool). When a transaction is made, the next available key is selected from the keypool for receiving change. The keypool is then periodically refilled with a new batch of keys as necessary. This \emph{key churn} requires users to periodically create new backups of their key storage file to ensure that new keypool keys are stored. 

% The user must also be wary of \textit{key churn} as the \bitcoinclient client sends change to new addresses. By default, it creates private keys in batches of 100 (called a keypool). This has the unfortunate side-effect that backups become obsolete after the user churns through their current keypool. The user interface of \bitcoinclient does not display change addresses or give any indication that they are being used, and so it is quite natural that a novice users' mental model will not account for this behaviour, and they will not act accordingly to ensure they re-backup \walletfile each time they deplete the keypool (another event that is not communicated to the user in any way). To address key churn, alternative Bitcoin clients return all change to the same address or derive all change addresses, called a \textit{deterministic wallet}, from a single key.


% Another disadvantage of using \bitcoinclient is that it requires a copy of the entire blockchain to validate the balance associated with each of the keys it will create. At the time of writing, the blockchain is 18 GB.\footnote{\url{https://blockchain.info/charts/blocks-size}} For a new installation, it is not uncommon for it to take days to obtain a local copy of blockchain from the Bitcoin peer-to-peer network.

% \paragraph{Mobile Wallets} A number of mobile wallets for OSes like Android and BlackBerry have been proposed, including Bitcoin-wallet\footnote{\url{https://androidobservatory.org/app/9A33CF64239CC26F6E52F80BE83AF39B93F261C0}} and Mycelium.\footnote{\url{http://mycelium.com}} The main challenge for mobile platforms is the general unfeasibility of obtaining and storing the entire blockchain. Instead, they implement a `thin client' approach which shortcuts full validation of the blockchain by placing bounded trust in the Bitcoin peer-to-peer network (specifically, it uses a protocol called simplified payment verification or SPV~\cite{Nak08}). SPV is also used on some desktop clients. Regarding key management, mobile clients are not much different from \bitcoinclient and still store keys in a local file on the device that is subject to the same threats: unauthorized access and non-preservation.

\subsection{Password-protected (Encrypted) Wallets}
Certain Bitcoin clients allow a locally stored wallet file to be encrypted with a key derived from a user-chosen password or passphrase. 
%A common approach is to use the well known password-based key derivation function (PBKDF2~\cite{pbkdf2}). 
Password-protected wallets appear to address only \emph{physical} theft of the underlying storage device, requiring brute-force of the password if the file containing private keys is stolen. Password protection seems less useful in the case of \emph{digital} theft; if malware can be installed on to the device storing the wallet, it is reasonable to assume a keystroke-logging module would be present, limiting or nullifying the benefits of the password protection.

% At the time of our analysis, this was possible but not the default in \bitcoinclient, however it is enabled by default in Multibit\footnote{\url{https://www.multibit.org}}, another popular desktop client. 
Password-protected wallets share the advantages and disadvantages of non-encrypted wallets (see Section~\ref{sec:localstorage}), with a few subtle differences. Password-protected wallets trade recoverability and usability for the mitigation of physical theft. If the password is forgotten, users lose the balance of their password-protected wallet since no mechanism exists for recovery\footnote{Of course, exhaustive search of the password space is theoretically possible, and is available as a service: \url{http://www.walletrecoveryservices.com}}. For day-to-day use, users must unlock the wallet by entering their password when new transactions are made. 

% The trade-off of a password-protected wallet is that users can lose their XBT by forgetting the password protecting their wallet. No recovery mechanism exists (as this mechanism could itself be exploited in the case of theft) short of exhaustive search, which is an available service.\footnote{\url{http://www.walletrecoveryservices.com}}

Password-protected wallets may mislead the user to believe that the password itself provides access to their funds regardless of the location of the device storing the wallet, as would be congruent with a traditional mental model for web-based online banking. Users may be surprised to discover that they cannot access their funds at a new device by simply entering their encryption password; the wallet file must also be transferred to the new device. 

\subsection{Offline Storage of Keys}
\label{sec:offline storage}
To further protect Bitcoin private keys from malware-based threats, wallets can be stored offline on some form of portable media, such as a USB thumbdrive. Keeping keys offline enables the use of traditional physical security techniques (\eg storing the drive in a fire-proof safe) to protect the wallet. However, offline storage has the drawback of making the wallet inaccessible for immediate use by software, preventing users from spending funds unless the offline storage media is nearby. As expected, offline storage can be used for backup, but all copies of the wallet must be kept offline for the full benefits of theft-protection to be realized. Prior to offline storage (wallet creation) and after storage (future transactions), the wallet will be exposed on a computational device, potentially to malware. 

\begin{figure}[pt]
  \includegraphics[width=.48\textwidth]{figures/paperwallet.png}
  \caption{Bitcoin paper wallet generated using \url{https://bitcoinpaperwallet.com}. The printout is designed to be folded such that the private key (right) remains hidden while the public component (left) remains visible.}
  \label{fig:paperwallet}
\end{figure}

An interesting case of offline key storage is paper wallets (see ~\autoref{fig:paperwallet})
%\footnote{\url {https://bitcoinpaperwallet.com}}\
where private keys are printed onto paper typically in the form of a 2D barcode (\eg a QR code) or as a long sequence of characters. Barcodes facilitate reading the key back into a Bitcoin client by, for example, scanning the code with a smartphone camera. Securing a paper wallet is similar to securing cash, which most users should be comfortable with. However, funds can be stolen from a paper wallet by simply observing the QR code (\eg on live television\footnote{``A Bloomberg TV Host Gifted Bitcoin On Air And It Immediately Got Stolen,'' \textit{Business Insider}, 10/23/2013.}), which is not possible with physical money. Thus transporting a paper wallet securely requires that the printed contents remain unobservable at all times.  Users must remember that a paper wallet does not contain the funds itself, but rather enables signing authority over a set of Bitcoins. For example, if a paper wallet is discarded after funds are spent, the paper wallet still provides access to any future funds that may be sent to that address.\footnote{``Five Ways to Lose Money with Bitcoin Change Addresses,'' \textit{Bitzuma} (Blog), 17/03/2014.} 

%Finally, users still need to be cautious of key churn and that spending XBT from a paper wallet does not result in XBT being sent to a change address not included in the paper wallet. 

As with any long-term storage, users must preserve software capable of decoding the QR code in the event that the paper wallet generation service is unavailable when attempting to reload keys onto a device. As of writing, many Bitcoin clients as well as offline storage solution use a common ``wallet import format'', which involves manipulating an ECDSA private key by performing cryptographic hashes, adding a checksum for integrity, and encoding the resulting string into Base58.\footnote{Base58 avoids the use of characters such as ``0, O, I, and l'' which may look visually similar, and also avoids punctuation characters which may trigger software (\eg e-mail clients) to perform line breaks.}

\subsection{Air-gapped Key Storage}
In offline storage, we assume the device or media on which the wallet resides cannot perform computations such as creating digital signatures. We distinguish this type of storage from air-gapped storage, where wallets are stored on a secondary device that generates, signs, and exports transactions, but this secondary device is never connected to a network. When spending Bitcoin funds using an air-gapped device, a transaction is created from the air-gapped device and the resulting signed output transported (usually through portable media) to an Internet-enabled device for transmission onto the Bitcoin network. 
%A notable client supporting this setup is Armory.\footnote{\url{https://bitcoinarmory.com}} 

An air gap improves theft-resistance by never directly using a private key on an Internet-connected device. However, air gapped devices are capable of actually executing malware if infected. Malware may jump the air gap by infecting the portable media used to export signed transactions.

While not literally an air gap, hardware security modules (HSMs) emulate the properties of an air gap by isolating the key material from the host device, and only exposing the ability to sign transactions. Bitcoin-specific HSMs are under active development at the time of writing and a few have been recently released (\eg Trezor\footnote{\url{http://www.bitcointrezor.com}}).

Note that the consequences of obtaining unauthorized access to the private keys in a wallet is not much different from accessing a transaction-signing oracle for the wallet---both allow the current balance of Bitcoin to be stolen. However, future funds may be protected if access to the signing oracle is non-persistent. 


\subsection{Password-derived Keys} 
Thus far, all key management solutions have required users to maintain cryptographic keys. The remaining two solutions enable users to access their Bitcoin with a password instead. 

The first approach is to derive cryptographic keys from a user-chosen password (\eg using PBKDF2~\cite{pbkdf2}, manipulating the output to produce a valid Bitcoin private key). The disadvantage of using this approach directly is that only one resulting keypair is created, requiring the user to select a new (different) password for a new keypair. 

A more robust approach is described in the Bitcoin Enhancement Proposal 32~\cite{bip32}, and is known as a Hierarchical Deterministic Wallet (HD Wallet). HD wallets deterministically derive a set of private keys from a master secret (a randomly chosen passphrase). These keys can derive new private keys. The deterministic nature allows the password holder to view the balance, as well as spend the funds, of any sub-account derived from the password. However, if the private key on one of the sub-accounts is compromised, only the funds sent to that sub-key (or sub-keys derived from it) may be stolen. 

% applied to the password and expand the seed into the required number of keys with a PRG. Thus it is a special case of a deterministic wallet, where the initial seed is password-derived instead of randomly chosen. A notable tool here is Brainwallet.\footnote{\url{http://brainwallet.org/}}

Password-derived wallets are targeted at loss-prevention and simpler cross-device access. The challenges of preserving access to a digital file are no longer necessary as long as the wallet can be re-generated from a memorized password. The primary drawback of a password-derived wallet is that weak user-chosen passwords can be found through unthrottled exhaustive search since a fingerprint of the associated public key will be in the global public ledger if the account holds any amount of Bitcoin. Rainbow tables~\cite{oechslin2003making} for password-derived keys have been  developed.\footnote{D. Martyn. ``Bitcoin `Brainwallets' and why they are a bad idea,'' \textit{Insecurety Research \emph{(sic)}} (Blog), 26 Mar 2013.} Finally, it remains unclear whether memorization poses an advantage over maintaining a digital file when preventing loss---a forgotten password will orphan all funds in the account.


\subsection{Hosted Wallets} 
A final approach to key management is to host user accounts on a third-party web service. In this case, the service maintains possession of the private keys. Hosted wallet web services provide the user with access to transactional functionalities through standard web authentication mechanisms, such as a password or two-factor authentication, and may also offer password recovery mechanisms. Currency exchange services that allow Bitcoin to be purchased and sold for fiat currency effectively provide this service, as do web services deployed specifically to host wallets.

% The popularity of hosted wallets appears to be justified, since these services provide the closest experience to traditional online banking. However, their use has also been hampered by high profile breaches and fraud. Users' funds have been unrecovered from services such as Mt.Gox and Bitcoinica, while popular exchanges such as BTC-E have suffered losses but fully reimbursed users. Thefts and losses from/by third party services are catalogued online\footnote{https://bitcointalk.org/index.php?topic=576337.0} and include over 40 events involving losses greater than 1000 XBT.\footnote{At the time of writing, 1000 XBT > 650\,000 USD.}

%proofs of solvency?
It is natural to expect hosted wallet services will become primary targets of attack since these services typically hold large amounts of Bitcoin. Offloading the task of key management to a third-party requires users to assume the risk that the service could be breached and funds lost, in exchange for a traditional online banking-style user experience. 

As a counter-measure to theft, hosted wallet providers often keep only a small float of their holdings online (called \textit{hot storage}) and store the majority of their holdings offline in \textit{cold storage}. This has the drawback of causing delays in transactions for users if the hot storage amount is exhausted.
%and is still susceptible if hot storage theft goes undetected as the float will be persistently replenished. 
Hosted wallet services may also allow audits, where they cryptographically prove possession of sufficient Bitcoin to match their liabilities.  
%to demonstrate that they are not covering up any missing XBT (which would not necessarily be immediately apparent---\cf \fixme{a fractional reserve)}.  

Another approach that falls under the hosted wallet category is a hybrid hosted wallet. Hybrid wallets use client side encryption (typically in Javascript) to encrypt all private keys and sensitive data. The web service is then only used for broadcasting transactions to the network and for displaying the user's balance (which requires inspecting the entire blockchain).

%Other than server side encryption and security measures, It uses client side encryption (javascript) to encrypt all the private keys and sensitive data with user's password and sends the encrypted data as a random base64 string to the server. With this implementation, there is no access to the private keys and the final balance from anyone whom have access to the server's data \footnote{\url{http://bitcoin.stackexchange.com/questions/5249/how-secure-is-blockchain-info}}. Blockchain.info uses this implementation for its hosted wallet.

% = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

\input{sections/newtable}

\section{Evaluation Framework}
% In this paper, we evaluated different approaches to key management in Bitcoin from both a systems perspective and a usability persecutive. On the usability side, in particular, some findings are very specific to the exact design of the software evaluated and its interfaces. Other usability issues are more fundamental to the category of key management the particular tool falls under. 
In this section, we systematize the major category-wide issues we have uncovered in describing the various key management approaches used by Bitcoin clients. We present an evaluation framework based on 10 criteria as shown in Table~\ref{tab:prims} and discussed in the following subsections. This framework both summarizes the advantages and disadvantages of the various approaches we have evaluated, while also providing a benchmark for evaluating future key management proposals. The framework is adapted from a similar framework for evaluating password replacement schemes~\cite{BHOS12}.

\subsection{Evaluation Criteria}
We briefly enumerate the criteria used to evaluate each proposal in the framework below. 

\paragraph{Malware Resistant}
\label{Malware Resistant}
Malware designed to steal Bitcoin wallets and related passwords has been observed in the wild. Wallets that are not stored on an Internet-connected device, or devices capable of performing computations are considered malware resistant (\full), unless creating a transaction involves transferring to a computational device (\prt). 

\paragraph{Key Stored Offline}
\label{Key Kept Offline}
For archival storage of infrequently used keys, keys not directly accessible from an Internet-connected device---either due to being offline (\full) or online but password-protected (\prt)---are preferable. 
%(For traditional banking online, we interpret this benefit as authority over the account being kept offline, which it is not).

\paragraph{No Trusted Third Party}
\label{No Trusted Third Party}
All Bitcoin key management tools are trusted to a certain extent. 
%Even an open source Bitcoin client might contain an undiscovered backdoor that kleptographicly steals high value private keys. 
This criteria considers the absence of a persistent trusted third party (\full) that maintains direct signing authority over a user's Bitcoin. 

\paragraph{Resistant to Physical Theft}
\label{Resistant to Physical Theft}
If the cryptographic keys are stored on some media or device that can be physically stolen, we do not consider the tool to be resistant to physical theft. Within our framework, the only tools meeting this requirement rely on a human memorized password being necessary for key recovery. These are awarded (\prt) since passwords tend to be weak and may not adequately resist unthrottled guessing. 

\paragraph{Resistant to Physical Observation}
\label{Resistant to Physical Observation}
Physical observation, such as observing key strokes or capturing QR codes with a camera, may result in access to a user's Bitcoin account. 

\paragraph{Resilient to Password Loss}
\label{Resilient to Password Loss}
% NOTE: I changed the first score from (\full ~ if not) to (\prt), but it's somehow unclear and might need further explanation
If passwords are used (\prt), the loss of a password could result in some Bitcoin becoming unrecoverable if it is a necessary authentication factor in obtaining access to the signing key. For solutions where funds are held by third parties, these entities could provide a password recovery/reset mechanism (\full).

\paragraph{Resilient to Key Churn}
\label{Compatible with Change Keys}
Assuming the client sends change from transactions to a newly created change addresses, a tool is resilient to key churn if it can maintain access to the funds even after exhausting the initial keypool (\full). Tools not awarded this benefit are not guaranteed to maintain persistent access to new change addresses, and any balance sent to these addresses may be lost.

\paragraph{Immediate Access}
\label{Immediate Access}
Key management mechanisms that maintain direct access to the wallet enable Bitcoin to be transacted immediately (\full). We award this benefit to techniques that require a user to enter a password. We omit the benefit for techniques that require data to be obtained from external storage medium or secondary device. 

\paragraph{No New User Software}
\label{No New Software}
Some approaches require users to install new software on their system, for which the user may not have suitable permission, or software may not be developed for their specific platform (\eg some mobile platforms). By contrast, some tools can be executed from widely available software such as any standards-compliant web browser (\full). 

\paragraph{Cross-Device Portability}
\label{Portable}
A key management technique is cross-device portable (\full) if it allows easy sharing of the a Bitcoin address across multiple devices with minimal configuration or usability issues due to complexities like key churn.

\subsection{Discussion}
\autoref{tab:prims} demonstrates that key management approaches provide varying levels of security and convenience, with no single approach being obviously superior to others. One possible takeaway from our evaluation and comparison is that users can benefit heavily by offloading key management to a trusted party (\eg hosted wallets). The lower right side of the chart focuses on usability properties that are already present in traditional financial services (\ie resilient to password loss, no new software, cross-device portability). These properties are difficult to obtain if users independently manage their keys through one of the local storage techniques. Of course, the disadvantage of trusting a third party is that Bitcoin funds are now bound by a contractual agreement between users and the hosted wallet provider, negating one of the primary features of Bitcoin: a fully decentralized currency. Users in countries lacking regulatory maturity for digital currencies should exercise caution when trusting a third party with large amounts of Bitcoin. 

Based on our analysis, users can be given the concrete advice of treating digital currency much like they would treat fiat currency: keeping small amounts in ready-to-spend form (\eg local storage or online hosted walled) mimicking cash, and keeping larger sums in more difficult to access but more secure storage (\eg air-gapped or offline storage) mimicking a savings account or trust fund. Barber \etal~\cite{Barber2012} suggest the use of ``super wallets'' where users essentially run their own personal bank. A super-wallet keeps keys across multiple devices and requires all (or a subset using a threshold scheme) to be present to transfer funds to sub-wallets. Pre-configured transfers of small amounts can be authorized to move funds to sub-wallets that can be used for day-to-day spending. While the idea of super-wallets is intuitive, the implementation of such a scheme could introduce high levels of complexity. 



% , no one tool provides a clearly beneficial set of properties over another. We also note that the approaches are not necessarily mutually exclusive. One tool may be used for a small float of XBT, while longer term savings may utilize a different mechanism. The hosted wallet solution provides essentially the same set of properties as online banking---what it lacks is regulatory maturity, consumer protection, and established businesses with track records that earn the trust (encapsulated by the trusted third party criteria) instilled in them. Of all the solutions, further development in hosted wallets seems the most promising for further Bitcoin adoption, primarily among novice users.

% = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

\section{Usability Evaluation of Bitcoin Clients}

\subsection{Methodology}

We used a series of cognitive walkthroughs~\cite{WRLP94} to evaluate the usability of six Bitcoin clients. Cognitive walkthrough is a form of expert evaluation where an expert (or group of experts) steps through the design to evaluate aspects of its usability. The focus of the walkthrough is on the novice user and emphasizes \emph{learnability}. At each step, the evaluators ask three questions: Will the user see what to do? Will the user see how to do it? And once it is done, will the user know if they have done the right thing?

We chose to use cognitive walkthroughs for several reasons. First, it allowed us to choose and compare standard tasks on disparate tools, and gave us easily compared insight into the common problems and successes of different Bitcoin clients. The cognitive walkthrough also allowed us to keep the focus on the novice user. Gathering novice users of Bitcoin for a user study could potentially be quite difficult; Bitcoin is still comparatively uncommon, and many users are also Bitcoin enthusiasts, often with additional knowledge of cryptography or PKI. Bitcoin is only in the process of developing a base of novice users. %citecheck: Not sure what to cite here...! maybe say something about being anecdotal??

%A number of usability evaluation methodologies employ expert review. We use a cognitive walkthrough \cite{WRLP94}, which has been used previously to study closely-related subjects: public key technology~\cite{WT99} and software configuration~\cite{COA07}. A cognitive walkthrough is premised on the idea that users learn through exploration of the software, instead of reading manuals. They attempt to perform the task they want completed and rely on the interface to intuitively guide them through proper design, interface cues, and feedback. 

For our cognitive walkthrough, we defined a set of core tasks that a typical user needs to perform. We compared the results of each walkthrough against a standard set of evaluation guidelines, combining aspects of an heuristic evaluation~\cite{HeuristicEvaluation} with the walkthrough in order to interpret our results. 

We used the following four tasks to evaluate each tool:

\begin{compactlist}
	\item[\bf T1] Configure a new Bitcoin address and obtain its balance. This task involves launching the Bitcoin client (or logging into one if hosted online) for the first time. After a new address has been generated (either explicitly or transparently in the background), the user should be confident that the address' balance is XBT~0.00000000. The user should also be able to find their receiving Bitcoin address.\label{sec:ct-1}
	\item[\bf T2] Spend Bitcoin. Send some amount of Bitcoin to an arbitrary (but valid) Bitcoin address. This task requires the user to create a new transaction, entering relevant information such as recipient, amount, \etc\label{sec:ct-2}
	\item[\bf T3] Spend Bitcoin from the same address as above, but on a secondary device. This task may require copying private keys to the secondary device, entering passwords on multiple devices, or logging in to a hosted wallet provider on a different browser.\label{sec:ct-3}
	\item[\bf T4] Recover from the loss of the main credential. In the case of locally stored keys, this task involves restoring a file from backup. Otherwise this task involves recovering from password loss.\label{sec:ct-4}
\end{compactlist}

Since the focus of our walkthrough was on configuration and learnability, we used a set of heuristics first developed for a usability evaluation of Tor~\cite{COA07}. We chose to use these guidelines because like the anonymity software, successfully managing Bitcoin involves the application of complex cryptographic knowledge in an everyday activity. The set of guidelines, from~\cite{COA07}, are: 

%The literature contains a variety of evaluation guidelines or heuristics to use for expert review of security-related tools. We chose to use the guidelines proposed in a usability evaluation of configuring the anonymity software Tor~\cite{COA07} since we share a focus on configuration. 
%This set is itself culled from numerous sources in the literature~\cite{WRLP94,WT99,Cra03,KBK05,COB06}.


	
\begin{compactlist}
	\item[\bf G1] Users should be aware of the steps they have to perform to complete a core task.
	\item[\bf G2] Users should be able to determine how to perform these steps.
	\item[\bf G3] Users should know when they have successfully completed a core task.
	\item[\bf G4] Users should be able to recognize, diagnose, and recover from non-critical errors.
	\item[\bf G5] Users should not make dangerous errors from which they cannot recover.
	\item[\bf G6] Users should be comfortable with the terminology used in any interface dialogues or documentation.
	\item[\bf G7] Users should be sufficiently comfortable with the interface to continue using it.
	\item[\bf G8] Users should be aware of the application's status at all times.
\end{compactlist}


%Cognitive walkthroughs are primarily relied on when the breadth of the evaluation makes a user or field study prohibitive to run due to time and cost. We examine six Bitcoin key managers, from configuration through transaction authorization through key recovery. If the results of the cognitive walkthrough narrows the field significantly, user studies are an appropriate follow-up for detailed examination of the most challenging set of tasks within one or two solutions. Thus while our result can be considered a first-pass at the problem, we felt the richness of the result merits sole presentation.

\subsection{Evaluated Clients}
Real-world evaluation of the general approaches detailed in \autoref{sec:approaches} is difficult. Thus, we select six distinct Bitcoin clients or utilities that implement the key management approaches described. For the purposes of our usability evaluation, each client was evaluated in its default configuration on OS X unless otherwise stated. 

\paragraph{Keys in Local Storage} The reference Bitcoin client, Bitcoin Core~\cite{bitcoinqt}, is a cross-platform client that stores keys locally (optionally encrypted with a password). Bitcoin Core is the first recommended client for download on the \url{bitcoin.org} website. 

\paragraph{Password-protected (Encrypted) Wallet} We use the MultiBit~\cite{multibit} client (also recommended on \url{bitcoin.org}) since by default all private keys are encrypted with a user-chosen password. 

\paragraph{Offline Storage} We use paper wallets as offline storage. While paper wallets can be as simple as printing private keys on to paper, we select the paper wallet creation website \url{Bitaddress.org}~\cite{bitaddress}. Bitaddress allows users to generate new randomized keys in their web browsers, and then print QR encoded keys. 

\paragraph{Air-gapped Storage} We select the Bitcoin Armory~\cite{bitcoinarmory} client which includes functionality for creating an offline wallet that can be used to sign and export transactions. 

\paragraph{Password-derived Keys} One of the simplest ways to create a password-derived key is on the Brainwallet~\cite{brainwallet} website. The site allows users to enter a passphrase which is converted into a private key. 

\paragraph{Hosted Wallets} We use \url{Blockchain.info}~\cite{blockchain} as our hosted wallet provider. As of writing, Blockchain.info advertises the management of over 2.5 million user wallets.

%===========================================================

\input{sections/walkthrough}
%\input{sections/walkthrough-full}

% = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

\section{Discussion}
% discuss more things from above. how do these things make it hard for novice users to get into bitcoin (bring this into the intro as well)

% consistency across tools, standards can make things fail. be careful. 

%has anyone explicitly considered this stuff? let's try to do better, since there is an open question in the literature. bring bitcoin to the masses. 
% tie back to general approaches, comment on whether any particular approach seems most promising. comment on the relationship of more coddled vs more control. the promises are decentralized, but centralized appears to be the way to go. 

% bitcoin as an opportunity to usably do key management

% design recommendations / research problems

\subsection{Metaphors}

Bitcoin naturally invites a metaphor to traditional currency. This metaphor is often used in the clients (\eg send coins, receive coins, wallet), but does not always support their usability. The coin metaphor fails in both of the ways that user interface metaphors traditionally fail~\cite{metaphorpaper}: aspects of Bitcoin transactions do not easily fit the coin metaphor, and conversely, encourages users to overextend the metaphor. Both of these lead to confusion on the part of users.   

One way in which the metaphor of physical coins fails is in the sending and receiving of Bitcoin. In the physical world, the same physical token is almost always used to represent the same unit of currency (\ie giving money to a friend involves handing them the coin). However, when Bitcoins are exchanged, the private key is not transferred along with the balance. Private keys remain in possession of the sender, and can be reused and associated with new coins at a later time. 

Many of the evaluated clients use the word ``Send'' to describe authorizing (digitally signing) a transaction, and private keys are not mentioned in any of the evaluated clients at the moment of transaction. It may appear counter-intuitive that this is a bad thing, but never mentioning the existence of keys may cause further confusion. The password-protected wallets, (\eg Multibit) require the user to input their password, but the programs do not clarify the reason for the password.

Addresses are another metaphor that relate to the issue of transacting. The evaluated clients use the word ``Address'' to refer to the public key associated with a private key held by some user. This seems to be a relatively successful metaphor: it emphasizes the public nature of the public key, and also divorces the user's perception of a relationship between the public and private keys. To momentarily extend the metaphor, a user is accustomed to the idea that they will need to share their address in order to receive an item. However, the private key is more akin to the key to their mailbox, and a user would never think that they should share their mailbox key in order to receive mail to an address. 

Another pervasive metaphor in the evaluated clients is the Bitcoin ``wallet'', where the user's Bitcoins are stored. The wallet metaphor is deeply entrenched in the foundations of Bitcoin. The reference client, \emph{Bitcoin Core}, stores private keys in a file named wallet.dat and the \emph{MultiBit} client invites users to ``create your first wallet!'' on first launch. The hosted clients also use the metaphor; Blockchain.info prominently shows a Wallet tab, under which users are invited to ``Create My Free Wallet". The wallet metaphor is descriptive for users, but fails to encompass the complexity of a user's collection of keys. In reality, the Bitcoin wallet contains private keys, but the term wallet is used to describe both the file storing the private keys, and the main interface of Bitcoin clients (as in Blockchain.info). This main interface sometimes includes a variety of other information, such as transaction history, address book, currency exchange rates, \etc

%``\fixme{My homepage}'' could be a more suitable term for the main interface of the Bitcoin client, which might include the wallet.

\subsection{Abstractions}

Abstraction and automation are complex issues for security software. Often, security is too complex to be completely automated, and the problem cases are often punted to the user (\eg in the case of TLS certificates~\cite{SSLSobey}).  

On first run, all of the evaluated clients transparently generate keypairs without informing the user. This behaviour continues as new transactions are made, where clients generate new addresses with no user notification (\eg for receiving change). It is unclear how well this abstraction works: while users do not need to be burdened with the knowledge of each private key, there are still situations in which a user might need to manage those keys, and the abstraction prevents users from doing so. Recovery from key loss depends on the existence of an up-to-date backup. While backup sounds like a simple task, in many of the evaluated clients, it involves finding the right menu (MultiBit), or the right file (Bitcoin Core). Some clients do prompt the user to back up their wallets (\eg Bitcoin Armory), but with the private keys so completely abstracted away, users may not even understand what they are backing up, or why. Key churn, and the consequent need for semi-regular backups complicate the issue even farther. %\eg Bitcoin Armory's approach involving a single key and user-prompted backups introduces privacy issues to avoid key churn.

The abstractions made in Bitcoin clients are sometimes beneficial for users, such as in the case of displaying a user's balance. A user's Bitcoin balance is typically made up of many small amounts corresponding to many private keys. However, most of the evaluated clients abstract these balances into a single figure. This highlights a usability disadvantage of paper wallets -- the user must manage these multiple balances manually, and there is no method of seeing an aggregate balance when multiple paper wallets are in use.

\subsection{Technical Language and Content}
\begin{figure}[htb]
        \centering
        \subfloat[\bitcoinclient]{
        \includegraphics[width=.48\textwidth]{btcore-sync}
        \label{fig:btcore-sync}
        }
                
        \subfloat[\multibit]{
        \includegraphics[width=.45\textwidth]{multibit-sync}
        \label{fig:multibit-sync}
        }
        
%        \subfloat[\armory]{
%        \includegraphics[width=.45\textwidth]{armory-sync}
%        \label{fig:armory-sync}
%        }
        \caption{Screenshots of technical language displayed by two different clients. }\label{fig:techlang}
\end{figure}
%
When performing our evaluation, we identified multiple occurrences of highly specialized or technical language used in the Bitcoin clients. These instances of technical language are confusing, particularly to novice users who are unlikely to be aware of either the jargon, and for whom the language will not help clarify the issues. The language itself highlights the complexity of the tasks associated with Bitcoin, and the difficulty of explaining them simply.

Examples of such language included messages in \multibit and  \bitcoinclient that referenced the client being ``out of sync'' or ``synchronizing with network'' (see Figure~\ref{fig:btcore-sync}) referring the process of downloading a full copy of the blockchain or retrieving relevant blocks from a trusted peer. A related message in \multibit (Figure~\ref{fig:multibit-sync}) and \armory displayed the number of blocks that had been downloaded, as well as the number of connections to the Bitcoin network. These messages are intended to communicate that clients may benefit from faster transaction notifications when connected to more peers, but since peer connectivity is difficult for users to control, there is little benefit in communicating these ideas with the user. Similarly, the number of blocks independently has little significance to most tasks performed by an end user. We suggest that not only could this language be clarified, but that the interfaces could also streamline the amount of information that is presented to the user on every screen.

%``no free outputs to spend'' 
We also noticed that some clients used highly technical language when they could have used the metaphor to provide a simpler explanation to users. When attempting to authorize a new transaction on \block with insufficient funds, the web interface displayed ``no free outputs to spend''. This error message is confusing, and would be more easily understood if it referred to the lack of coins instead of the lack of outputs. Similarly, essential actions such as importing or exporting keys were often buried behind advanced or debug menus. 

%Number of blocks, date of last block, 

% Bitcoin Armory was the client that displayed the most technical language, but was also the client with the greatest amount of contextual help. Most technical jargon in the client is neighbored by a question mark, which provides plain language explanations of what the setting or message means (see Figure~\ref{fig:armorytechlang}). 

% \begin{figure}[pt]
%   \centering
%   \includegraphics[width=.3\textwidth]{armorytechlang}
%   \caption{Detailed contextual help displayed in the Bitcoin Armory client user interface. Upon hovering over the ``?'' next to the Security field, a simple explanation is displayed.}
%   \label{fig:armorytechlang}
% \end{figure}

%\subsection{Help and Documentation}

In the evaluated clients, there were often few resources to which users could turn for help. In the cognitive walkthroughs, the answer to the question ``will the user know what to do?" was almost always unclear. Interface cues and features such as tool tips, wizards, or other contextual help were almost entirely lacking. Some actions were guided (\eg Multibit's prompted backups or create your first wallet), but many actions such as obtaining the balance of a paper or password-derived address were unsupported by help or documentation.  


%===========================================================

\section{Conclusion}

Bitcoin's rising popularity poses a new set of challenges to its usability, particularly related to key management. In this paper, we compared six Bitcoin key management approaches and evaluated the usability of clients that implement these techniques. We find that developers in the Bitcoin ecosystem are making innovative attempts at solving the decades-old problem of usable key management. While some of these techniques seem promising, our usability evaluation uncovers systemic issues that must be addressed before Bitcoin can be widely adopted. Bitcoin presents a new opportunity for public key cryptography to become mainstream, and our evaluation is a first step towards achieving usable key management in decentralized cryptocurrencies. 

%that Bitcoin clients are taking a new approach to key management, but that the effort is as yet not fully developed. Usability issues relating to poor metaphors, abstractions, and technical language were uncovered by our cognitive walkthroughs. 

%Our detailed security and usability evaluation of six competing tools for key management in Bitcoin essentially demonstrates that no silver bullet solution has been deployed. Addressing the documented usability issues, fundamental to Bitcoin's design due to its reliance on cryptographic keys, is an important first step toward wider adoption of Bitcoin or similar cryptocurrencies. 

%While usability is often pitched with the novice user in mind, the issue of key management can be equally troubling for expert users. As a thought experiment, imagine how you would protect your Bitcoin wallet were it to contain XBT worth the equivalent of millions of dollars. With a complete lack of consumer protection, the reality that a loss of the associated private key will orphan the funds, and the threat of malware and targeted attacks tailored to Bitcoin theft, it is doubtful that anyone would prefer the dubious task of maintaining a Bitcoin wallet over depositing the funds into an insured bank account. 

%\begin{itemize}
%  \item better import/export of keys
%  \item better language and guidance on key management 
%  \item how do you know the key is in wallet.dat ?  
%  \item How do you know if a file has been read? Specifically, how do you know if your private key file has been read by an app other than your wallet? We have unix \texttt{atime} (time of last access), but we can't log what process read the file. 
%  \item publishing public keys. people need to keep these around, and they can use to check if they have the right privkey. 
%  \item if you have your pubkey and you have the salt, you can avoid rainbow tables, but your pubkeys get longer. (add salt via commitcoin) 
%  \item boyen iterated hashing of passwords -> compute amount of iterations based on money, script
%  \item digital death
%  \item sinkhole accounts
%  \item incentives are there because it's money. not like ssh or ssl. 
%  \item min password entropy as a function of how much money its protecting: examine in terms of falling cost to brute force (e.g. w/ EC2), vs rising price of bit coins. -> future proof against lowering EC2 costs and raising bitcoin costs
%  \item bitbills, oblivious printing and other physically intuitive media that can behave (sort of) like cash
%  \item theft/loss mitigation, making it easier to split wallets to mitigate loss
%  \item account rollover vs. password changes
%  \item graphical passwords
%  \item security of RNGs. i read that vanitygen (for making vanity bitcoin addresses) uses OpenSSL's RNG and it's secure because it's ``used on thousands of websites''. 
%  \item air gap -> how good is it?
%  \item How do Bitcoin millionaires sleep at night?
%\end{itemize}

% = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = =

